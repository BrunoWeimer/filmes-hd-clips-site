<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player IPTV Premium</title>
  <style>
    body {
      margin: 0;
      background: #0f0f0f;
      color: white;
      font-family: Arial, sans-serif;
    }
    .login-box {
      background: #1a1a1a;
      max-width: 400px;
      margin: 50px auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
    }
    .login-box h1 {
      text-align: center;
      color: #ff0000;
      margin-bottom: 20px;
    }
    .login-box input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      background: #2a2a2a;
      border: none;
      border-radius: 5px;
      color: white;
    }
    .login-box button {
      width: 100%;
      padding: 12px;
      background: #ff0000;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .player-section {
      display: none; /* Só aparece após login */
    }
    #video-player {
      width: 100%;
      height: 500px;
      background: black;
    }
    .channel-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }
    .channel-btn {
      background: #252525;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      text-align: left;
    }
    .channel-btn:hover {
      background: #ff3333;
    }
  </style>
</head>
<body>
  <!-- Tela de Login -->
  <div class="login-box" id="login-box">
    <h1>Acessar Player IPTV</h1>
    <form onsubmit="handleLogin(event)">
      <input type="text" id="username" placeholder="Usuário" required>
      <input type="password" id="password" placeholder="Senha" required>
      <button type="submit">Entrar</button>
    </form>
  </div>

  <!-- Player (aparece após login) -->
  <div class="player-section" id="player-section">
    <video id="video-player" controls></video>
    <div class="channel-list" id="channel-list"></div>
  </div>

  <script>
    // ✅ SERVIDOR JÁ CONFIGURADO (florentix.com)
    const XTREAM_SERVER = "http://florentix.com";

    // Elementos do DOM
    const loginBox = document.getElementById('login-box');
    const playerSection = document.getElementById('player-section');
    const videoPlayer = document.getElementById('video-player');
    const channelList = document.getElementById('channel-list');

    // Função de login
    async function handleLogin(event) {
      event.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      try {
        // Verifica se o login é válido
        const authUrl = `${XTREAM_SERVER}/player_api.php?username=${username}&password=${password}`;
        const response = await fetch(authUrl);
        const data = await response.json();

        if (data.user_info && data.user_info.auth === 1) {
          loginBox.style.display = 'none';
          playerSection.style.display = 'block';
          loadChannels(username, password);
        } else {
          alert("Usuário ou senha incorretos!");
        }
      } catch (error) {
        alert("Erro ao conectar. Verifique sua internet.");
        console.error(error);
      }
    }

    // Carrega lista de canais via M3U
    async function loadChannels(username, password) {
      const m3uUrl = `${XTREAM_SERVER}/get.php?username=${username}&password=${password}&type=m3u_plus`;
      
      try {
        const response = await fetch(m3uUrl);
        const m3uData = await response.text();
        const channels = parseM3U(m3uData);

        channelList.innerHTML = ''; // Limpa lista

        channels.forEach(channel => {
          const btn = document.createElement('button');
          btn.className = 'channel-btn';
          btn.textContent = channel.name;
          btn.onclick = () => playStream(channel.url);
          channelList.appendChild(btn);
        });
      } catch (error) {
        alert("Erro ao carregar canais. Tente novamente.");
        console.error(error);
      }
    }

    // Extrai canais do M3U
    function parseM3U(data) {
      const lines = data.split('\n');
      const channels = [];
      
      for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith('#EXTINF')) {
          const name = lines[i].split(',')[1].trim();
          const url = lines[i + 1].trim();
          channels.push({ name, url });
        }
      }
      
      return channels;
    }

    // Reproduz o stream
    function playStream(url) {
      if (url.includes('.m3u8')) {
        // Se for HLS, usa Hls.js (para melhor compatibilidade)
        if (typeof Hls !== 'undefined' && Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(videoPlayer);
          hls.on(Hls.Events.MANIFEST_PARSED, () => videoPlayer.play());
        } else {
          alert("Seu navegador não suporta HLS. Use Chrome ou Firefox.");
        }
      } else {
        // Se for TS ou outro formato, tenta reproduzir diretamente
        videoPlayer.src = url;
        videoPlayer.play().catch(e => alert("Erro ao reproduzir."));
      }
    }
  </script>

  <!-- Suporte para HLS (opcional, melhora compatibilidade) -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>
